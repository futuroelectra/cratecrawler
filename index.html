<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crate Crawler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/png" href="logo.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { crateBlue: '#1A00FF' },
          fontFamily: { display: ['Quicksand', 'sans-serif'] },
          borderRadius: { pill: '9999px' },
        },
      },
    };
  </script>
</head>
<body class="min-h-screen flex items-center justify-center bg-white">
  <main class="w-full flex items-center justify-center px-4">
    <section class="flex flex-col items-center text-center" style="max-width: 340px;">
      <img src="logo.png" alt="Crate Crawler logo" class="mb-4 w-20 h-20 object-contain" />
      <h1 class="font-display font-bold text-3xl md:text-4xl text-crateBlue mb-2 tracking-tight">Crate Crawler</h1>
      <p class="text-xs text-crateBlue max-w-xs mb-8" style="line-height: 1.35;">
        Find a page on Discogs, filter it down, copy the URL, &amp; get a youtube playlist sent to you.
      </p>

      <form id="crawler-form" class="w-full flex flex-col gap-4">
        <input id="email" type="email" required placeholder="Email" class="w-full px-4 py-3 rounded-pill border-[3px] border-crateBlue focus:outline-none text-sm placeholder:text-crateBlue/50 bg-white" />
        <input id="discogs-url" type="url" required placeholder="Discogs URL" class="w-full px-4 py-3 rounded-pill border-[3px] border-crateBlue focus:outline-none text-sm placeholder:text-crateBlue/50 bg-white" />
        
        <button id="submit-btn" type="submit" class="w-full mt-2 py-3 rounded-pill bg-crateBlue text-white font-semibold text-sm tracking-wide hover:bg-crateBlue/90 transition disabled:opacity-60">
          SUBMIT
        </button>

        <a href="/privacy" class="text-[10px] text-crateBlue/60 hover:text-crateBlue underline transition-colors">
          Privacy Policy
        </a>

        <p id="error-msg" class="mt-1 text-xs text-red-500 hidden">Something went wrong. Please try again.</p>
      </form>

      <div id="success-msg" class="hidden mt-6 text-sm text-crateBlue">
        <p class="font-semibold">Check your inbox! The playlist is on its way.</p>
      </div>
    </section>
  </main>

  <script>
    const N8N_WEBHOOK_URL = 'https://connorjoejoseph.app.n8n.cloud/webhook/069cd45c-2f92-49a9-b8ad-457428c3ce7b';
    const form = document.getElementById('crawler-form');
    const submitBtn = document.getElementById('submit-btn');
    const errorMsg = document.getElementById('error-msg');
    const successMsg = document.getElementById('success-msg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorMsg.classList.add('hidden');
      const email = document.getElementById('email').value.trim();
      const discogsUrl = document.getElementById('discogs-url').value.trim();
      
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'CRAWLING...';

      try {
        const response = await fetch(N8N_WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, discogsUrl }),
        });
        const data = await response.json();
        if (data.authUrl) {
          window.location.href = data.authUrl;
        } else if (response.ok) {
          form.classList.add('hidden');
          successMsg.classList.remove('hidden');
        } else {
          throw new Error();
        }
      } catch (e) {
        errorMsg.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      if (new URLSearchParams(window.location.search).get('status') === 'success') {
        form.classList.add('hidden');
        successMsg.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
